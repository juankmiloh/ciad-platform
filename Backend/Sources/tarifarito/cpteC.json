{
    "name": "empresas",
    "query": [
        "SELECT ",
        "    FT7.ID_EMPRESA AS EMPRESA,",
        "    FT7.CAR_T1669_ID_MERCADO AS MERCADO,",
        "    FT7.CAR_CARG_ANO AS ANO,",
        "    FT7.CAR_CARG_PERIODO AS MES,",
        "    FT7.CAR_T1669_NT_PROP AS NT_PROP,",
        "    FT3.C6, T9.C1, FT7.C7, FT7.C8, FT7.C9, FT7.C10, FT7.C11, T9.C13, FTC2.C20, FTC2.C22, FTC2.C24, FTC2.C21, T9.C14, T9.C15, T9.C16, FTC2.C23, FTC2.C25, T9.C28, T9.C29, T9.C30,",
        "    T9.C31, T9.C32, T9.C36, T9.C34, T9.C33, T9.C37, T9.C35, T9.C38, FTC2.C59, FT2.C69, FT2.C70, FT2.C71, T9.C58, FTC2.C60, T9.C44, T9.C47, T9.C48, T10.C52, T10.C53, FTC2.C55, FT2.C56 ",
        "FROM ",
        "(",
        "    SELECT CERTIFICADO.QUA_EST_ESTADO, RUPS.*, FTE2.* FROM ",
        "    (",
        "        SELECT ",
        "            VGSTR.*  ",
        "        FROM",
        "        (",
        "            SELECT VUTG.*, TPG3.TIPO_GARANTIA_3 AS C71 FROM ",
        "            (",
        "                SELECT ",
        "                    FECHAS.*,",
        "                    TPG1_2.TIPO_GARANTIA_1 AS C56,",
        "                    TPG1_2.TIPO_GARANTIA_2 AS C69,",
        "                    NVL(TPG1_2.TIPO_GARANTIA_2 / SUM_VENTAS_REGULADOS.SUMC60, 0) AS C70",
        "                FROM ",
        "                (",
        "                    SELECT ID_EMPRESA, NVL(TIPO_GARANTIA_1, 'SIN VALOR') AS FECHAS_TIPO_GARANTIA_1, NVL(TIPO_GARANTIA_2, 'SIN VALOR') AS FECHAS_TIPO_GARANTIA_2, NVL(TIPO_GARANTIA_3, 'SIN VALOR') AS FECHAS_TIPO_GARANTIA_3 FROM ",
        "                    (",
        "                        SELECT ID_EMPRESA, CAR_T1667_TIPO_GARANTIA, VALOR FROM ",
        "                        (",
        "                            SELECT ",
        "                                ID_EMPRESA,",
        "                                CAR_T1667_TIPO_GARANTIA,",
        "                                CAR_T1667_MES_RECUPERACION,",
        "                                CAR_CARG_PERIODO,",
        "                                CASE WHEN CAR_T1667_MES_RECUPERACION > CAR_CARG_PERIODO THEN 'CUMPLE' ELSE 'NO CUMPLE' END AS VALOR ",
        "                            FROM ",
        "                                ENERGIA_CREG_015.CAR_GARANTIA_FINANCIERA ",
        "                            WHERE ",
        "                                CAR_CARG_ANO = :ANIO_ARG ",
        "                                AND CAR_CARG_PERIODO = :PERIODO_ARG ",
        "                                AND (ID_EMPRESA = :EMPRESA_ARG OR 0 = :EMPRESA_ARG) ",
        "                                AND CAR_T1667_TIPO_GARANTIA IN (1, 2, 3) ",
        "                        )",
        "                    )",
        "                    PIVOT ",
        "                    (",
        "                        MAX(VALOR) ",
        "                        FOR ",
        "                            CAR_T1667_TIPO_GARANTIA ",
        "                        IN ('1' AS TIPO_GARANTIA_1, '2' AS TIPO_GARANTIA_2, '3' AS TIPO_GARANTIA_3) ",
        "                    )",
        "                ) FECHAS,",
        "                (",
        "                    SELECT ID_EMPRESA, NVL(TIPO_GARANTIA_1, 0) AS TIPO_GARANTIA_1, NVL(TIPO_GARANTIA_2, 0) AS TIPO_GARANTIA_2 FROM ",
        "                    (",
        "                        SELECT ",
        "                            ID_EMPRESA,",
        "                            CAR_T1667_TIPO_GARANTIA,",
        "                            NVL(CASE WHEN CAR_T1667_TIPO_GARANTIA = 1 THEN SUM(CAR_T1667_COSTO_A_RECUPERAR) ELSE SUM(CAR_T1667_COSTO_A_RECUPERAR) END, 0) AS VALOR ",
        "                        FROM ",
        "                            ENERGIA_CREG_015.CAR_GARANTIA_FINANCIERA ",
        "                        WHERE ",
        "                            CAR_CARG_ANO = :ANIO_ARG ",
        "                            AND CAR_CARG_PERIODO = :PERIODO_ARG ",
        "                            AND (ID_EMPRESA = :EMPRESA_ARG OR 0 = :EMPRESA_ARG) ",
        "                            AND CAR_T1667_TIPO_GARANTIA IN (1, 2) ",
        "                        GROUP BY ID_EMPRESA, CAR_T1667_TIPO_GARANTIA",
        "                    )",
        "                    PIVOT ",
        "                    (",
        "                        MAX(VALOR) ",
        "                        FOR ",
        "                            CAR_T1667_TIPO_GARANTIA ",
        "                        IN ('1' AS TIPO_GARANTIA_1, '2' AS TIPO_GARANTIA_2) ",
        "                    )",
        "                ) TPG1_2,",
        "                (",
        "                    SELECT ",
        "                        SUM(SUM_VENTAS_REGULADOS.VRI + SUM_VENTAS_REGULADOS.VRR) AS SUMC60 ",
        "                    FROM ",
        "                    (",
        "                        SELECT MERCADO, NVL(SUM(VRI), 0) AS VRI, NVL(SUM(VRR), 0) AS VRR FROM (",
        "                        SELECT ",
        "                            TO_NUMBER(SUBSTR(CAR_T1743_MERCADO_NIU, 1, INSTR(CAR_T1743_MERCADO_NIU, '-')-1)) AS MERCADO,",
        "                            CASE WHEN CAR_T1743_TIPO_FACT = 1 THEN (CAR_T1743_CONS_USUARIO + CAR_T1743_CONS_CDC) END AS VRI,",
        "                            CASE WHEN CAR_T1743_TIPO_FACT <> 1 THEN ",
        "                                CASE WHEN car_t1743_val_rft_cu >=0 THEN (CAR_T1743_RFT_CU*1) + CAR_T1743_RFT_CDC ELSE (CAR_T1743_RFT_CU*-1) + CAR_T1743_RFT_CDC END ",
        "                            END AS VRR ",
        "                        FROM ENERGIA_CREG_015.CAR_T1743_TC2FACTURACION_USU ",
        "                        WHERE ",
        "                            IDENTIFICADOR_EMPRESA = :EMPRESA_ARG ",
        "                            AND CAR_CARG_PERIODO = :PERIODO_ARG_MENOS2 ",
        "                            AND CAR_CARG_ANO = :ANIO_ARG ",
        "                            AND CAR_T1743_TIPO_TARIFA = 1 ",
        "                        ) GROUP BY MERCADO",
        "                    ) SUM_VENTAS_REGULADOS ",
        "                ) SUM_VENTAS_REGULADOS",
        "            ) VUTG,",
        "            (",
        "                SELECT MERCADOS.ID_MERCADO, MERCADOS.NOM_MERCADO, GRT3.* FROM ",
        "                (",
        "                    SELECT ID_EMPRESA, RUPS.ARE_ESP_SECUE, RUPS.ARE_ESP_NOMBRE, GARANTIAS3.CAR_T1667_NIT_BENEFICIARIO, GARANTIAS3.TIPO_GARANTIA_3 FROM ",
        "                    (",
        "                        SELECT ID_EMPRESA, CAR_T1667_NIT_BENEFICIARIO, NVL(TIPO_GARANTIA_1, 0) AS TIPO_GARANTIA_1, NVL(TIPO_GARANTIA_2, 0) AS TIPO_GARANTIA_2, NVL(TIPO_GARANTIA_3, 0) AS TIPO_GARANTIA_3 FROM ",
        "                        (",
        "                            SELECT ID_EMPRESA, CAR_T1667_NIT_BENEFICIARIO, CAR_T1667_TIPO_GARANTIA, VALOR FROM ",
        "                            (",
        "                                SELECT ",
        "                                    ID_EMPRESA,",
        "                                    CAR_T1667_NIT_BENEFICIARIO,",
        "                                    CAR_T1667_TIPO_GARANTIA,",
        "                                    NVL(SUM(CAR_T1667_COSTO_A_RECUPERAR), 0) AS VALOR ",
        "                                FROM ",
        "                                    ENERGIA_CREG_015.CAR_GARANTIA_FINANCIERA ",
        "                                WHERE ",
        "                                    CAR_CARG_ANO = :ANIO_ARG ",
        "                                    AND CAR_CARG_PERIODO = :PERIODO_ARG ",
        "                                    AND (ID_EMPRESA = :EMPRESA_ARG OR 0 = :EMPRESA_ARG) ",
        "                                GROUP BY ID_EMPRESA, CAR_T1667_NIT_BENEFICIARIO, CAR_T1667_TIPO_GARANTIA",
        "                            )",
        "                        )",
        "                        PIVOT ",
        "                        (",
        "                            MAX(VALOR) ",
        "                            FOR ",
        "                                CAR_T1667_TIPO_GARANTIA ",
        "                            IN ('1' AS TIPO_GARANTIA_1, '2' AS TIPO_GARANTIA_2, '3' AS TIPO_GARANTIA_3) ",
        "                        )",
        "                    ) GARANTIAS3,",
        "                    (",
        "                        SELECT ARE_ESP_NOMBRE, ARE_ESP_SECUE, ARE_ESP_NIT FROM RUPS.ARE_ESP_EMPRESAS",
        "                    ) RUPS",
        "                    WHERE GARANTIAS3.CAR_T1667_NIT_BENEFICIARIO = RUPS.ARE_ESP_NIT",
        "                ) GRT3,",
        "                (",
        "                    SELECT ",
        "                        DISTINCT ID_MERCADO,",
        "                        ARE_ESP_SECUE,",
        "                        NOM_MERCADO,",
        "                        ESTADO ",
        "                    FROM ",
        "                        CARG_COMERCIAL_E.MERCADO_EMPRESA ",
        "                    WHERE ",
        "                        ID_MERCADO = :MERCADO_ARG OR 0 = :MERCADO_ARG ",
        "                        AND ESTADO = 'A' ",
        "                        AND NOM_MERCADO NOT LIKE '%Mercado Prueba%' ",
        "                        AND NOM_MERCADO NOT LIKE '%Mercado de Prueba%' ",
        "                    UNION ",
        "                    SELECT  ",
        "                        20481 AS ID_MERCADO,",
        "                        20481 AS ARE_ESP_SECUE,",
        "                        'XM COMPAÃ‘IA DE EXPERTOS EN MERCADOS S.A. E.S.P.' AS NOM_MERCADO,",
        "                        'A' AS ESTADO ",
        "                    FROM DUAL",
        "                ) MERCADOS ",
        "                WHERE GRT3.ARE_ESP_SECUE = MERCADOS.ARE_ESP_SECUE",
        "            ) TPG3",
        "        ) VGSTR",
        "    ) FTE2,",
        "    (",
        "        SELECT ARE_ESP_NOMBRE, ARE_ESP_SECUE, ARE_ESP_NIT FROM RUPS.ARE_ESP_EMPRESAS",
        "    ) RUPS,",
        "    (",
        "        SELECT CASE WHEN EXISTS (",
        "            SELECT ",
        "                QUA_EST_ESTADO ",
        "            FROM CALIDAD_SUI.FAC_QUA_ESTADO ",
        "            WHERE ",
        "                CAR_TIAR_CODIGO = '1667' ",
        "                AND ARE_ESP_SECUE = :EMPRESA_ARG ",
        "                AND EXTRACT(YEAR FROM QUA_EST_FCHCERT) = :ANIO_ARG ",
        "                AND EXTRACT(MONTH FROM QUA_EST_FCHCERT) = :PERIODO_ARG",
        "            ) ",
        "            THEN 'CERTIFICADO' ELSE 'NO CERTIFICADO' ",
        "            END AS QUA_EST_ESTADO",
        "        FROM CALIDAD_SUI.FAC_QUA_ESTADO",
        "        WHERE ROWNUM = 1",
        "    ) CERTIFICADO",
        "    WHERE FTE2.ID_EMPRESA = RUPS.ARE_ESP_SECUE",
        ") FT2,",
        "(",
        "    SELECT ",
        "         DISTINCT CAR_T1668_ID_MERCADO, ",
        "         MAX(CAR_T1668_TARIFA_CFJM) AS C6 ",
        "    FROM ",
        "        ENERGIA_CREG_015.CAR_TARIFAS_PUBLICADAS ",
        "    WHERE ",
        "        CAR_CARG_ANO = :ANIO_ARG ",
        "        AND CAR_CARG_PERIODO = :PERIODO_ARG ",
        "        AND (ID_EMPRESA = :EMPRESA_ARG OR 0 = :EMPRESA_ARG) ",
        "        AND (CAR_T1668_ID_MERCADO = :MERCADO_ARG OR 0 = :MERCADO_ARG) ",
        "    GROUP BY CAR_T1668_ID_MERCADO,",
        "             CAR_T1668_TARIFA_CFJM",
        ")FT3,",
        "(",
        "    SELECT ",
        "        CAR_1672_CFJ AS C1,",
        "        CAR_1672_RCT AS C13,",
        "        CAR_1672_RCAE AS C14,",
        "        CAR_1672_IFSSRI AS C15,",
        "        CAR_1672_IFOES AS C16,",
        "        CASE WHEN CAR_1672_BALANCE_SUBSIDIOS = 'D' THEN 'DEFICITARIO' ELSE 'SUPERAVITARIO' END AS C28,",
        "        CAR_1672_ANIO AS C29,",
        "        CAR_1672_TRIM AS C30,",
        "        CAR_1672_MG_TRIM AS C31,",
        "        CAR_1672_SUB1 AS C32,",
        "        CAR_1672_R1 AS C36,",
        "        CAR_1672_N AS C34,",
        "        CAR_1672_SUB2 AS C33,",
        "        CAR_1672_R2 AS C37,",
        "        CAR_1672_M AS C35,",
        "        CAR_1672_FACTURACION AS C38,",
        "        CAR_1672_PUI AS C58,",
        "        CAR_1672_CREG AS C47,",
        "        CAR_1672_SSPD AS C48,",
        "        CASE WHEN CAR_1672_ACTIVIDAD = 'CP' THEN 'COMERCIALIZADOR PURO' ELSE 'COMERCIALIZADOR INTEGRADO' END AS C44,",
        "        CAR_CARG_ANO,",
        "        CAR_CARG_PERIODO,",
        "        ID_EMPRESA,",
        "        CAR_1672_ID_MERCADO ",
        "    FROM ",
        "        ENERGIA_CREG_015.CAR_VAR_COSTO_UNT_PS_CU_119_UR ",
        "    WHERE ",
        "        CAR_CARG_ANO = :ANIO_ARG ",
        "        AND CAR_CARG_PERIODO = :PERIODO_ARG ",
        "        AND (ID_EMPRESA = :EMPRESA_ARG OR 0 = :EMPRESA_ARG) ",
        "        AND (CAR_1672_ID_MERCADO = :MERCADO_ARG OR 0 = :MERCADO_ARG) ",
        ") T9,",
        "(",
        "    SELECT ",
        "        CAR_T1671_CND AS C52,",
        "        CAR_T1671_SIC AS C53 ",
        "    FROM ENERGIA_CREG_015.CAR_T1671_INFORMACION_ASIC_LAC ",
        "    WHERE CAR_CARG_ANO = :ANIO_ARG ",
        "    AND CAR_CARG_PERIODO = :PERIODO_ARG ",
        "    AND (CAR_T1671_ID_EMPRESA = :EMPRESA_ARG OR 0 = :EMPRESA_ARG) ",
        ") T10,",
        "(",
        "    SELECT ",
        "        CAR_CARG_ANO,",
        "        CAR_CARG_PERIODO,",
        "        ID_EMPRESA,",
        "        CAR_T1669_ID_MERCADO,",
        "        CAR_T1669_NT_PROP,",
        "        CAR_T1669_GM AS C7,",
        "        CAR_T1669_TM AS C8,",
        "        CAR_T1669_PRNM AS C9,",
        "        CAR_T1669_DNM AS C10,",
        "        CAR_T1669_RM AS C11 ",
        "    FROM ENERGIA_CREG_015.CAR_COSTO_UNITARIO_119_UR ",
        "    WHERE ",
        "        (ID_EMPRESA = :EMPRESA_ARG OR 0 = :EMPRESA_ARG) ",
        "        AND (CAR_T1669_ID_MERCADO = :MERCADO_ARG OR 0 = :MERCADO_ARG) ",
        "        AND CAR_CARG_ANO = :ANIO_ARG ",
        "        AND CAR_CARG_PERIODO = :PERIODO_ARG_MENOS1 ",
        "        AND CAR_T1676_ANIO_CORREG IS NULL ",
        ")FT7,",
        "(",
        "    SELECT ",
        "        FACTURAI.MERCADO,",
        "        NVL((FACTURAI.C20 + REFACT.C20), 0) AS C20, NVL((FACTURAI.C21 + REFACT.C21), 0) AS C21,",
        "        NVL((FACTURAI.C22 + REFACT.C22), 0) AS C22, NVL((FACTURAI.C23 + REFACT.C23), 0) AS C23,",
        "        NVL((FACTURAI.C24 + REFACT.C24), 0) AS C24, NVL((FACTURAI.C25 + REFACT.C25), 0) AS C25,",
        "        VENTAS_TOTALES.C55 AS C55,",
        "        VENTAS_REGULADOS.C60 AS C60,",
        "        USUARIOS.CANT_USUARIOS AS C59 ",
        "    FROM ",
        "    (",
        "        SELECT MERCADO, SUM(CAMPO20) AS C20, SUM(CAMPO21) AS C21, SUM(CAMPO22) AS C22, SUM(CAMPO23) AS C23, SUM(CAMPO24) AS C24, SUM(CAMPO25) AS C25 FROM ",
        "        (",
        "            SELECT ",
        "                TO_NUMBER(SUBSTR(CAR_T1743_MERCADO_NIU, 1, INSTR(CAR_T1743_MERCADO_NIU, '-')-1)) AS MERCADO,",
        "                CASE WHEN (CAR_T1743_TIPO_USU_RC = 1) ",
        "                THEN (CAR_T1743_CONS_USUARIO + CAR_T1743_CONS_CDC) END AS CAMPO20,",
        "                CASE WHEN (CAR_T1743_TIPO_USU_RC = 2) ",
        "                THEN (CAR_T1743_CONS_USUARIO + CAR_T1743_CONS_CDC) END AS CAMPO21,",
        "                CASE WHEN (CAR_T1743_TIPO_USU_RC = 3) ",
        "                THEN (CAR_T1743_CONS_USUARIO + CAR_T1743_CONS_CDC) END AS CAMPO22,",
        "                CASE WHEN (CAR_T1743_TIPO_USU_RC = 4) ",
        "                THEN (CAR_T1743_CONS_USUARIO + CAR_T1743_CONS_CDC) END AS CAMPO23,",
        "                NVL(CASE WHEN (CAR_T1743_TIPO_USU_RC = 5) ",
        "                THEN (CAR_T1743_CONS_USUARIO + CAR_T1743_CONS_CDC) END, 0) AS CAMPO24, ",
        "                NVL(CASE WHEN (CAR_T1743_TIPO_USU_RC = 6) ",
        "                THEN (CAR_T1743_CONS_USUARIO + CAR_T1743_CONS_CDC) END, 0) AS CAMPO25 ",
        "            FROM ENERGIA_CREG_015.CAR_T1743_TC2FACTURACION_USU ",
        "            WHERE ",
        "                IDENTIFICADOR_EMPRESA = :EMPRESA_ARG ",
        "                AND CAR_CARG_PERIODO = :PERIODO_ARG_MENOS1 ",
        "                AND CAR_CARG_ANO = :ANIO_ARG ",
        "                AND CAR_T1743_TIPO_FACT IN (1)",
        "        )",
        "        GROUP BY MERCADO",
        "    ) FACTURAI,",
        "    (",
        "        SELECT MERCADO, SUM(CAMPO20) AS C20, SUM(CAMPO21) AS C21, SUM(CAMPO22) AS C22, SUM(CAMPO23) AS C23, SUM(CAMPO24) AS C24, SUM(CAMPO25) AS C25 FROM ",
        "        (",
        "            SELECT ",
        "                TO_NUMBER(SUBSTR(CAR_T1743_MERCADO_NIU, 1, INSTR(CAR_T1743_MERCADO_NIU, '-')-1)) AS MERCADO,",
        "                CASE WHEN (CAR_T1743_TIPO_USU_RC = 1) ",
        "                THEN ",
        "                (",
        "                    CASE WHEN car_t1743_val_rft_cu >=0 THEN (CAR_T1743_RFT_CU*1) + CAR_T1743_RFT_CDC ELSE (CAR_T1743_RFT_CU*-1) + CAR_T1743_RFT_CDC END",
        "                ) END AS CAMPO20,",
        "                CASE WHEN (CAR_T1743_TIPO_USU_RC = 2) ",
        "                THEN ",
        "                (",
        "                    CASE WHEN car_t1743_val_rft_cu >=0 THEN (CAR_T1743_RFT_CU*1) + CAR_T1743_RFT_CDC ELSE (CAR_T1743_RFT_CU*-1) + CAR_T1743_RFT_CDC END",
        "                ) END AS CAMPO21,",
        "                CASE WHEN (CAR_T1743_TIPO_USU_RC = 3) ",
        "                THEN ",
        "                (",
        "                    CASE WHEN car_t1743_val_rft_cu >=0 THEN (CAR_T1743_RFT_CU*1) + CAR_T1743_RFT_CDC ELSE (CAR_T1743_RFT_CU*-1) + CAR_T1743_RFT_CDC END",
        "                ) END AS CAMPO22,",
        "                CASE WHEN (CAR_T1743_TIPO_USU_RC = 4) ",
        "                THEN ",
        "                (",
        "                    CASE WHEN car_t1743_val_rft_cu >=0 THEN (CAR_T1743_RFT_CU*1) + CAR_T1743_RFT_CDC ELSE (CAR_T1743_RFT_CU*-1) + CAR_T1743_RFT_CDC END",
        "                ) END AS CAMPO23,",
        "                CASE WHEN (CAR_T1743_TIPO_USU_RC = 5) ",
        "                THEN ",
        "                (",
        "                    CASE WHEN car_t1743_val_rft_cu >=0 THEN (CAR_T1743_RFT_CU*1) + CAR_T1743_RFT_CDC ELSE (CAR_T1743_RFT_CU*-1) + CAR_T1743_RFT_CDC END",
        "                ) END AS CAMPO24,",
        "                CASE WHEN (CAR_T1743_TIPO_USU_RC = 6) ",
        "                THEN ",
        "                (",
        "                    CASE WHEN car_t1743_val_rft_cu >=0 THEN (CAR_T1743_RFT_CU*1) + CAR_T1743_RFT_CDC ELSE (CAR_T1743_RFT_CU*-1) + CAR_T1743_RFT_CDC END",
        "                ) END AS CAMPO25 ",
        "            FROM ENERGIA_CREG_015.CAR_T1743_TC2FACTURACION_USU ",
        "            WHERE ",
        "                IDENTIFICADOR_EMPRESA = :EMPRESA_ARG ",
        "                AND CAR_CARG_PERIODO = :PERIODO_ARG_MENOS1 ",
        "                AND CAR_CARG_ANO = :ANIO_ARG ",
        "                AND CAR_T1743_TIPO_FACT NOT IN (1) ",
        "        )",
        "        GROUP BY MERCADO",
        "    ) REFACT,",
        "    (",
        "        SELECT MERCADO, NVL(SUM(VTI), 0) + NVL(SUM(VTR), 0) AS C55 FROM (",
        "        SELECT ",
        "            TO_NUMBER(SUBSTR(CAR_T1743_MERCADO_NIU, 1, INSTR(CAR_T1743_MERCADO_NIU, '-')-1)) AS MERCADO,",
        "            CASE WHEN CAR_T1743_TIPO_FACT = 1 THEN (CAR_T1743_CONS_USUARIO + CAR_T1743_CONS_CDC) END AS VTI,",
        "            CASE WHEN CAR_T1743_TIPO_FACT <> 1 THEN ",
        "                CASE WHEN car_t1743_val_rft_cu >=0 THEN (CAR_T1743_RFT_CU*1) + CAR_T1743_RFT_CDC ELSE (CAR_T1743_RFT_CU*-1) + CAR_T1743_RFT_CDC END ",
        "            END AS VTR ",
        "        FROM ENERGIA_CREG_015.CAR_T1743_TC2FACTURACION_USU ",
        "        WHERE ",
        "            IDENTIFICADOR_EMPRESA = :EMPRESA_ARG ",
        "            AND CAR_CARG_PERIODO = :PERIODO_ARG_MENOS1 ",
        "            AND CAR_CARG_ANO = :ANIO_ARG ",
        "        ) GROUP BY MERCADO",
        "    ) VENTAS_TOTALES,",
        "    (",
        "        SELECT ",
        "            VENTAS_REGULADOS.MERCADO,",
        "            VENTAS_REGULADOS.VRI + VENTAS_REGULADOS.VRR AS C60 ",
        "        FROM ",
        "        (",
        "            SELECT MERCADO, NVL(SUM(VRI), 0) AS VRI, NVL(SUM(VRR), 0) AS VRR FROM (",
        "            SELECT ",
        "                TO_NUMBER(SUBSTR(CAR_T1743_MERCADO_NIU, 1, INSTR(CAR_T1743_MERCADO_NIU, '-')-1)) AS MERCADO,",
        "                CASE WHEN CAR_T1743_TIPO_FACT = 1 THEN (CAR_T1743_CONS_USUARIO + CAR_T1743_CONS_CDC) END AS VRI,",
        "                CASE WHEN CAR_T1743_TIPO_FACT <> 1 THEN ",
        "                    CASE WHEN car_t1743_val_rft_cu >=0 THEN (CAR_T1743_RFT_CU*1) + CAR_T1743_RFT_CDC ELSE (CAR_T1743_RFT_CU*-1) + CAR_T1743_RFT_CDC END ",
        "                END AS VRR ",
        "            FROM ENERGIA_CREG_015.CAR_T1743_TC2FACTURACION_USU ",
        "            WHERE ",
        "                IDENTIFICADOR_EMPRESA = :EMPRESA_ARG ",
        "                AND CAR_CARG_PERIODO = :PERIODO_ARG_MENOS2 ",
        "                AND CAR_CARG_ANO = :ANIO_ARG ",
        "                AND CAR_T1743_TIPO_TARIFA = 1 ",
        "            ) GROUP BY MERCADO",
        "        ) VENTAS_REGULADOS",
        "    ) VENTAS_REGULADOS,",
        "    (",
        "        SELECT ",
        "            CAR_T1732_ID_COMER,",
        "            CAR_T1732_ID_MERCADO,",
        "            COUNT(*) AS CANT_USUARIOS FROM ",
        "        (",
        "            SELECT ",
        "                CAR_T1732_NIU,",
        "                CAR_T1732_ID_COMER,",
        "                CAR_T1732_ID_MERCADO ",
        "            FROM ENERGIA_CREG_015.CAR_T1732_TC1_INV_USUARIOS ",
        "            WHERE ",
        "                CAR_T1732_ID_COMER = :EMPRESA_ARG ",
        "                AND CAR_CARG_PERIODO = :PERIODO_ARG_MENOS2 ",
        "                AND CAR_CARG_ANO = :ANIO_ARG ",
        "            GROUP BY ",
        "                CAR_T1732_NIU,",
        "                CAR_T1732_ID_COMER,",
        "                CAR_T1732_ID_MERCADO",
        "        ) TC1",
        "        LEFT JOIN ",
        "        (    ",
        "            SELECT ",
        "                TO_NUMBER(SUBSTR(CAR_T1743_MERCADO_NIU, 1, INSTR(CAR_T1743_MERCADO_NIU, '-')-1)) AS MERCADO,",
        "                SUBSTR(CAR_T1743_MERCADO_NIU, INSTR(CAR_T1743_MERCADO_NIU, '-')+1) AS NIU ",
        "            FROM ENERGIA_CREG_015.CAR_T1743_TC2FACTURACION_USU ",
        "            WHERE ",
        "                IDENTIFICADOR_EMPRESA = :EMPRESA_ARG ",
        "                AND CAR_CARG_PERIODO = :PERIODO_ARG_MENOS2 ",
        "                AND CAR_CARG_ANO = :ANIO_ARG ",
        "                AND CAR_T1743_TIPO_TARIFA = 1 ",
        "            GROUP BY ",
        "                TO_NUMBER(SUBSTR(CAR_T1743_MERCADO_NIU, 1, INSTR(CAR_T1743_MERCADO_NIU, '-')-1)),",
        "                SUBSTR(CAR_T1743_MERCADO_NIU, INSTR(CAR_T1743_MERCADO_NIU, '-')+1)",
        "        ) TC2",
        "        ON ",
        "            TC1.CAR_T1732_NIU = TC2.NIU ",
        "            AND TC1.CAR_T1732_ID_MERCADO = TC2.MERCADO ",
        "        WHERE TC2.NIU IS NOT NULL ",
        "        GROUP BY ",
        "            CAR_T1732_ID_COMER,",
        "            CAR_T1732_ID_MERCADO",
        "    ) USUARIOS",
        ")FTC2 ",
        "WHERE FT7.CAR_T1669_NT_PROP = :NTPROP_ARG OR 'TODOS' = :NTPROP_ARG"
    ]
}